# Technopark_Highload
Технопарк. Проектирование высоконагруженных систем. Семестровый проект "Discord"

Бесплатный проприетарный мессенджер Discord для голосового общения посредством голосовых конференций

## MVP
1. Регистрация и авторизация
2. Голосовые конференции

## Целевая аудитория
~150 миллионов пользователей в месяц со всего мира использует Discord. Подавляющая часть пользователей располагается в Европе, в США и в России.

~14 миллионов пользователей в день посещают Discord.

Суммарно ~4 миллиарда минут ежедневно используется голосовыми конференциями. Пиковая нагрузка составляет ~2,78 миллионов пользователей, общающихся в голосовых конференциях одновременно.

Трафик голосовых конференций составляет 5,8 Мб в минуту на одну голосовую конференцию.

## Расчёт нагрузки
Можно пренебречь нагрузкой запросов на регистрацию и авторизацию, поскольку пользователи довольно редко выполняют их по сравнению с остальными запрсами, касающимися основной функциональности Discord.

### Продуктовые метрики
Средний размер хранилища пользователя, если учесть, что в среднем пользователь является создателем двух голосовых конференций, что он в один момент залогинен с двух устройств, составит (были учтены размеры полей в БД):

    324 (б)

Есть следующие виды запросов: создание голосовой конференции, вход в голосовую конференцию, выход из голосовой конференции, удаление голосовой конференции. Можно учесть, что каждый пользователь в среднем создаёт голосовую конференцию один раз в неделю, удаляет одну голосовую конференцию один раз в месяц, входит в голосовую конференцию и выходит из неё по 2 раза в день соответственно.

### Технические метрики
Суммарное количество минут, использованное голосовыми конференциями в месяц, составит:

    4 (миллиарда минут) * 30 (дней) = 120 (миллиардов минут в месяц)

Суммарный трафик, использованный голосовыми конференциями в месяц, составит:

    120 (миллиардов минут в месяц) * 5,8 (Мб в минуту) = 696 (миллиардов Мб в месяц) ~= 648 (Пб в месяц)

Тогда трафик, использованный голосовыми конференциями за одну секунду, составит:

    648 (Пб в месяц) / 30 (дней) / 24 (часа) / 60 (минут) / 60 (секунд) = 0,00025 (Пб в секунду) ~= 262,1 (Гб в секунду)

Если учесть, что при пиковой нагрузке трафик составляет в 3,5 раза больше средней, то пиковый трафик, использованный голосовыми конференциями за одну секунду, составит:

    262,1 (Гб в секунду) * 3,5 = 917,35 (ГБ в секунду)

Количество запросов, выполняемых на создание голосовых конференций в день, учитывая, что в среднем каждый седьмой посетивший Discord в определённый день пользователь создаёт одну конференцию, составит:

    14000000 (миллионов пользователей в день) * 1/7 (часть пользователей) = 2000000 (запроса в день)

Количество запросов, выполняемых на удаление голосовых конференций в день, учитывая, что в среднем каждый 30-й посетивший Discord в определённый день пользователь удаляет одну конференцию, составит:

    14000000 (миллионов пользователей в день) * 1/30 (часть пользователей) ~= 466667 (запросов в день)

Количество запросов, выполняемых на вход в голосовую конференцию и выход из неё, учитывая, что каждый пользователь в среднем по 2 раза в день выполняет каждый запрос соответственно, составит:

    14000000 (миллионов пользователей в день) * 4 (запроса) = 56000000 (запросов в день)

RPS, учитывая среднее количество выполнения каждого вида запроса, составит:

    (2000000 + 466667 + 56000000) / 24 (часа) / 60 (минут) / 60 (секунд) = 676 (RPS)

## Логическая схема

### ER-модель БД
![image](https://raw.githubusercontent.com/NikitaLobaev/Technopark_Highload/main/ER-model2.png)

#### Описание сущностей

Сущность USER — сильная и представляет собой пользователя. Она обладает следующим набором атрибутов: id (идентификатор), email, username (имя пользователя), password (пароль), birthday (дата рождения). Данная сущность идентифицируется по атрибуту id.

Сущность SESSION — слабая (зависит от сущности USER) и представляет собой авторизационную сессию пользователя. Она обладает следующим набором атрибутов: id (идентификатор), expires (дата окончания жизни сессии). Данная сущность идентифицируется по атрибуту id.

Сущность CONFERENCE — слабая (зависит от сущности USER) и представляет собой голосовую конференцию. Она обладает следующим набором атрибутов: id (идентификатор), slug (семантический URL). Данная сущность идентифицируется по атрибуту id.

Сущность USER_CONFERENCE — слабая (зависит от сущностей USER и CONFERENCE) и представляет собой участие пользователя в голосовой конференции. Она обладает следующим набором атрибутов: id (идентификатор). Данная сущность идентифицируется по атрибуту id.

#### Описание связей
Связь USER_SESSION типа «один ко многим» связывает сущности USER и SESSION. Участие сущности SESSION в данной связи является полным, USER — частичным.

Связь CONFERENCE_AUTHOR типа «многие к одному» связывает сущности CONFERENCE и USER. Участие сущности CONFERENCE в данной связи является полным, USER — частичным.

Связь UС_USER типа «многие к одному» связывает сущности USER_CONFERENCE и USER. Участие сущности USER_CONFERENCE в данной связи является полным, USER — частичным.

Связь UC_CONFERENCE типа «многие к одному» связывает сущности USER_CONFERENCE и CONFERENCE. Участие сущности USER_CONFERENCE в данной связи является полным, CONFERENCE — частичным.

### Реляционная модель БД
![image](https://raw.githubusercontent.com/NikitaLobaev/Technopark_Highload/main/relational-model.png)

## Физическая схема

## Ссылки на источники информации
- https://discord.com/brand-new/company
- https://vc.ru/services/73312-messendzher-dlya-geymerov-discord-oboshel-skype-i-zanyal-chetvertoe-mesto-po-auditorii-na-pk-v-rossii-v-aprele-2019-goda
- https://discordgid.ru/skolko-internet-trafika-tratit/
